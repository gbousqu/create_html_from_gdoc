
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>créer un site html à partir d'un gdoc avec onglets</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="sidebar">
    <button class="menu-toggle">☰ Menu</button>
    <h3>créer un site html à partir d'un gdoc avec onglets</h3>
    <div class="nav-menu">
      <ul><li class="nav-item">
      <a href="#tab-1741167374444-jol9dwsgt" class="nav-link">Projet</a></li><li class="nav-item">
      <a href="#tab-1741167374448-ao3n9bglv" class="nav-link">Notes</a></li><li class="nav-item">
      <a href="#tab-1741167374448-n0e1cx2t3" class="nav-link">Documentation</a></li></ul>
    </div>
  </div>
  <div class="content">
    <div id="tab-1741167374444-jol9dwsgt" class="tab-content">
      <h1 class="tab_title">Projet</h1>
      <div><h1 id="heading-projet-374445">Projet
</h1><p>Il y a des extensions ou bibliothèques qui prétendent faire cette conversion gdoc>html, mais elles ne tiennent pas compte de la "nouvelle" fonctionnalité onglets des gdoc.Or je souhaite : 
</p><ul><li>lister les onglets et sous-onglets du gdoc pour créer un menu html 
<li>parser le contenu de chaque onglet pour créer le html correspondant, avec : 
<ul><li>prise en charge des titres
<li>prise en charge des formats italiques, gras
<li>utilisation du css pour personnaliser le résultat
<li>prise en charge des liens externes
<li>récupération des images pour les mettre dans un dossier et pointer le src des balises img vers l'image dans ce dossier
</ul></li></ul><p>
</p><p>Quand on fait un simple fichier/partager/publier sur le web d'un gdoc, on aura que le premier onglet.
</p><p>Il faut aller dans google drive, puis clic-droit/télécharger pdf ou zip (html+dossier images) pour avoir le gdoc complet. Mais pas forcément avec le formatage qu'on souhaite. A creuser quand même ?
</p><h1 id="heading-a-faire-374447">A faire
</h1><ul><li>Fonctionnalité de <strong>recherche </strong>dans le contenu converti
<li>ajouter un chat IA sur le document
</li></ul><p>
</p><p>
</p><p>
</p></div>
    </div><div id="tab-1741167374448-ao3n9bglv" class="tab-content">
      <h1 class="tab_title">Notes</h1>
      <div><h1 id="heading-utilisation-de-lapi-google-doc-ct-client-374448">Utilisation de l'API Google Doc côté client
</h1><p>L'idée est de parser un gdoc avec l'api google doc client.Pour la prise en charge des  onglets, voir ici : <a href="https://developers.google.com/docs/api/how-tos/tabs?hl=fr" target="_blank" rel="noopener noreferrer">https://developers.google.com/docs/api/how-tos/tabs?hl=fr</a>	
</p><p>Le projet actuel  est ici 
</p><p> <strong>C:\wamp64\www\qcm_en_developpement\tests\test_create_html_from_gdoc
</strong></p><p><strong>et l'URL locale : 
</strong></p><p><a href="http://localhost/qcm_en_developpement/tests/test_create_html_from_gdoc/create_html_from_gdoc.html" target="_blank" rel="noopener noreferrer">http://localhost/qcm_en_developpement/tests/test_create_html_from_gdoc/create_html_from_gdoc.html</a>
</p><p><strong>
</strong></p><p><strong>La partie parsing est dans fonctions.js
</strong></p><p>Pour connaître toutes les propriétés et méthodes possibles pour l'api, il faut utiliser le "fichier de découverte" pour l'API.
</p><p><a href="https://docs.googleapis.com/$discovery/rest?version=v1" target="_blank" rel="noopener noreferrer">https://docs.googleapis.com/$discovery/rest?version=v1</a>	
</p><p>On peut regarder aussi :<a href="https://developers.google.com/docs/api/reference/rest/v1/documents?hl=fr" target="_blank" rel="noopener noreferrer">https://developers.google.com/docs/api/reference/rest/v1/documents?hl=fr</a>		
</p><p>C'est un json 
</p><p><img src="images/kix.fv011bdn85o2.png" alt="Image" class="inline-image" id="kix.fv011bdn85o2" data-object-id="kix.fv011bdn85o2" width="719" height="484">
</p><p>pour mieux le parcourir, on peut utiliser
</p><p><a href="https://jsonformatter.org/json-parser" target="_blank" rel="noopener noreferrer">https://jsonformatter.org/json-parser</a>	
</p><p><img src="images/kix.5j5m6wb3f3i0.png" alt="Image" class="inline-image" id="kix.5j5m6wb3f3i0" data-object-id="kix.5j5m6wb3f3i0" width="547" height="574">
</p><p>Exemple : 
</p><p><img src="images/kix.dh109yq6g3q8.png" alt="Image" class="inline-image" id="kix.dh109yq6g3q8" data-object-id="kix.dh109yq6g3q8" width="582" height="132">
</p><p>qui vient de : 
</p><p><img src="images/kix.wa734qqg9cbc.png" alt="Image" class="inline-image" id="kix.wa734qqg9cbc" data-object-id="kix.wa734qqg9cbc" width="491" height="286">
</p><p>
</p><p>et
</p><p><img src="images/kix.az23sm2nwm8g.png" alt="Image" class="inline-image" id="kix.az23sm2nwm8g" data-object-id="kix.az23sm2nwm8g" width="685" height="535">
</p><p>
</p><h1 id="heading-claude-sonnet-37-dans-visual-studio-code-374448">Claude sonnet 3.7 dans visual studio code
</h1><p>c'est l'IA que j'ai utilisé pour m'aider à faire le code avec mon abonnement copilot github
</p><p>Plus lent, mais beaucoup plus efficace
</p><p><img src="images/kix.60zf88wuedo.png" alt="Image" class="inline-image" id="kix.60zf88wuedo" data-object-id="kix.60zf88wuedo" width="571" height="253">
</p><p>
</p><h1 id="heading-version-en-ligne-374448">Version en ligne
</h1><p>Pour pouvoir utiliser l'API de Google pour parser le Google Doc, j'ai été obligé d'ajouter un nom de domaine, et pas seulement une adresse IP, dans les URI admissibles pour le client OAuth du projet Google.
</p><p>Donc l'hébergement de test est ici : 
</p><p><a href="https://suenolatino.fr/test_create_html_from_gdoc/create_html_from_gdoc.html" target="_blank" rel="noopener noreferrer">https://suenolatino.fr/test_create_html_from_gdoc/create_html_from_gdoc.html</a>
</p><p>
</p><p><a href="https://console.cloud.google.com/apis/credentials?referrer=search&inv=1&invt=Abq8fQ&project=test-big-query-janv-2019&pli=1" target="_blank" rel="noopener noreferrer">https://console.cloud.google.com/apis/credentials?referrer=search&inv=1&invt=Abq8fQ&project=test-big-query-janv-2019&pli=1</a>	
</p><p><img src="images/kix.f2p7fydaaze.png" alt="Image" class="inline-image" id="kix.f2p7fydaaze" data-object-id="kix.f2p7fydaaze" width="575" height="140">
</p><p><img src="images/kix.ms01npmb9850.png" alt="Image" class="inline-image" id="kix.ms01npmb9850" data-object-id="kix.ms01npmb9850" width="563" height="317">
</p><p>
</p></div>
    </div><div id="tab-1741167374448-n0e1cx2t3" class="tab-content">
      <h1 class="tab_title">Documentation</h1>
      <div><p>
</p><div class="table-of-contents">
        <h3>Table des matières</h3>
        <div class="toc-placeholder" data-auto-generated="true"></div>
      </div><p>
</p><h1 id="heading-documentation-gnre-par-claude-sonnet-37-374448">Documentation (générée par claude Sonnet 3.7)
</h1><h2 id="heading-rsum-374448">Résumé
</h2><p>Ce programme permet de convertir un document Google Docs en site HTML statique autonome, tout en préservant sa structure, son contenu, ses images et ses liens. Il transforme la structure d'onglets du document en une navigation web interactive, et gère diverses ressources comme les images insérées et les liens vers des fichiers externes (richLinks). Le site généré peut être hébergé sur n'importe quel serveur web.
</p><h2 id="heading-fonctionnement-gnral-374448">Fonctionnement général
</h2><h3 id="heading-flux-de-travail-374448">Flux de travail
</h3><ol><li>Authentification: L'utilisateur s'authentifie à l'API Google Docs
<li>Sélection du document: L'utilisateur entre l'ID du document Google Docs à convertir
<li>Analyse et extraction: Le programme analyse le document et extrait:
<ol><li>La structure des onglets et sous-onglets
<li>Le contenu HTML de chaque onglet
<li>Les objets insérés (images, liens vers des fichiers Drive)
</ol><li>Traitement des ressources:
<ol><li>Les images sont converties en base64 puis sauvegardées comme fichiers
<li>Les liens vers des fichiers Drive sont formatés avec des icônes appropriées selon leur type
</ol><li>Génération du site: Le programme:
<ol><li>Crée un dossier dédié au document (avec un nom basé sur le titre)
<li>Génère un fichier HTML principal avec la structure de navigation et le JavaScript nécessaire
<li>Sauvegarde les images dans un sous-dossier 'images'
<li>Copie le fichier CSS pour le style
</ol><li>Affichage du résultat: Le site généré est ouvert dans un nouvel onglet avec des informations sur l'emplacement des fichiers
</li></ol><h3 id="heading-architecture-technique-374450">Architecture technique
</h3><p>Le programme utilise:
</p><ol><li>JavaScript côté client pour interagir avec l'API Google
<li>PHP côté serveur pour la manipulation des fichiers et dossiers
<li>Une architecture modulaire séparant les responsabilités entre différentes fonctions
</li></ol><h2 id="heading-description-dtaille-des-fichiers-et-fonctions-374450">Description détaillée des fichiers et fonctions
</h2><h3 id="heading-fichiers-principaux-374450">Fichiers principaux
</h3><h4 id="heading-indexhtml-374450">index.html
</h4><p>Interface principale permettant à l'utilisateur de s'authentifier, sélectionner un document et lancer la conversion.
</p><h4 id="heading-fonctionsjs-374450">fonctions.js
</h4><p>Contient toutes les fonctions JavaScript pour l'authentification à Google, le traitement du document et la génération du site.
</p><h4 id="heading-stylescss-374450">styles.css
</h4><p>Définit le style visuel du site généré, avec la mise en page flexible, la navigation et la présentation des contenus.
</p><h4 id="heading-scripts-php-ct-serveur-374450">Scripts PHP côté serveur
</h4><ol><li>create_folders.php: Crée la structure de dossiers pour chaque document
<li>save_file.php: Sauvegarde le fichier HTML principal
<li>save_image.php: Sauvegarde les images extraites du document
<li>list_images.php: Liste les images existantes pour éviter de les télécharger à nouveau
<li>get_base_url.php: Détermine l'URL de base pour les liens du site généré
</li></ol><h3 id="heading-fonctions-principales-dans-fonctionsjs-374451">Fonctions principales (dans fonctions.js)
</h3><h4 id="heading-authentification-et-initialisation-374451">Authentification et initialisation
</h4><h5 id="heading-initclient-374451">initClient()
</h5><p>Initialise le client Google API avec les identifiants appropriés et les scopes nécessaires.
</p><h5 id="heading-handleauthclick-374451">handleAuthClick()
</h5><p>Gère le clic sur le bouton d'authentification et démarre le processus d'authentification à Google.
</p><h5 id="heading-updatesigninstatusissignedin-374451">updateSigninStatus(isSignedIn)
</h5><p>Met à jour l'interface utilisateur en fonction de l'état d'authentification.
</p><h4 id="heading-traitement-du-document-374451">Traitement du document
</h4><h5 id="heading-parsegoogledocfileid-374451">parseGoogleDoc(fileId)
</h5><p>Fonction centrale qui:
</p><ol><li>Récupère le document complet auprès de l'API Google Docs
<li>Extrait la structure des onglets et leur contenu
<li>Identifie tous les objets inline (images, richLinks)
<li>Collecte les données de ces objets
<li>Génère et affiche le site HTML résultant
</li></ol><h5 id="heading-processdoccontentcontent-374451">processDocContent(content)
</h5><p>Traite le contenu du document pour extraire le HTML, les styles et les liens.
</p><h5 id="heading-extracttabsdatatabs-374451">extractTabsData(tabs)
</h5><p>Extrait la structure complète des onglets et sous-onglets du document.
</p><h5 id="heading-getinlineobjectsdatafileid-inlineobjectids-374451">getInlineObjectsData(fileId, inlineObjectIds)
</h5><p>Récupère les données détaillées des objets insérés dans le document (images, liens Drive).
</p><h4 id="heading-conversion-et-traitement-des-ressources-374451">Conversion et traitement des ressources
</h4><h5 id="heading-convertimagetobase64imageurl-374451">convertImageToBase64(imageUrl)
</h5><p>Convertit une image en chaîne base64 pour inclusion dans le HTML ou sauvegarde.
</p><h5 id="heading-getexistingimagesfoldername-374451">getExistingImages(folderName)
</h5><p>Récupère la liste des images déjà existantes dans le dossier images du dossier HTML pour éviter les doublons et éviter de recréer les images si on lance plusieurs fois la conversion sur le même gdoc.
</p><h5 id="heading-processtabscontenttabsdata-objectdata-foldername-374451">processTabsContent(tabsData, objectData, folderName)
</h5><p>Prétraite le contenu des onglets pour adapter les références aux images et autres objets.
</p><h4 id="heading-gnration-et-sauvegarde-du-site-374451">Génération et sauvegarde du site
</h4><h5 id="heading-generatesitehtmldoctitle-tabsdata-objectdata-374451">generateSiteHtml(docTitle, tabsData, objectData)
</h5><p>Génère le code HTML complet du site avec la navigation, le contenu et le JavaScript nécessaire.
</p><h5 id="heading-generatenavigationmenutabsdata-level-374451">generateNavigationMenu(tabsData, level)
</h5><p>Génère le HTML pour le menu de navigation à partir de la structure d'onglets.
</p><h5 id="heading-generatetabcontenttabsdata-374451">generateTabContent(tabsData)
</h5><p>Génère le HTML pour le contenu des onglets.
</p><h5 id="heading-savegeneratedsitehtmlcontent-imagesdata-doctitle-374451">saveGeneratedSite(htmlContent, imagesData, docTitle)
</h5><p>Sauvegarde le site généré sur le serveur:
</p><ol><li>Crée un dossier nommé d'après le titre du document
<li>Sauvegarde le fichier HTML principal
<li>Traite et sauvegarde les images
<li>Copie le fichier CSS
</li></ol><h5 id="heading-displaygeneratedsitehtmlcontent-imagedata-doctitle-374452">displayGeneratedSite(htmlContent, imageData, docTitle)
</h5><p>Affiche les informations sur le site généré et ouvre le résultat dans un nouvel onglet.
</p><h3 id="heading-gestion-des-richlinks-374452">Gestion des richLinks
</h3><p>Le programme est particulièrement attentif à la détection des types de fichiers pour les liens externes (richLinks) du type fichiers sur Google Drive ou youTube.
</p><p>Les liens de ce type peuvent apparaître dans le gdoc sous la forme d'une puce montrant le type de fichier (gsheets, jpg, ..) avec comme texte le nom du fichier et non son URL.
</p><p> Il utilise plusieurs méthodes pour déterminer le type de fichier correct:
</p><ol><li>Le MIME type fourni par l'API Google Docs (méthode la plus fiable)
<li>L'analyse de l'URL pour les services Google identifiables (Sheets, Slides, etc.)
<li>L'analyse des extensions de fichiers dans l'URL ou le titre
<li>Des logiques spécifiques pour les liens Google Drive qui ne révèlent pas directement leur type
</li></ol><p>Chaque richLink est ensuite affiché avec une icône correspondant à son type (document, image, vidéo, etc.).
</p><h2 id="heading-bonnes-pratiques-implmentes-374452">Bonnes pratiques implémentées
</h2><ol><li>Optimisation des performances:
<ol><li>Réutilisation des images déjà téléchargées
<li>Chargement dynamique du contenu des onglets
</ol><li>Expérience utilisateur:
<ol><li>Navigation intuitive entre les onglets
<li>Préservation de la hiérarchie du document original
<li>Affichage adapté des liens vers les fichiers externes
</ol><li>Structure de code:
<ol><li>Séparation des responsabilités entre les fonctions
<li>Journalisation détaillée pour le débogage
<li>Gestion robuste des erreurs
</ol><li>Sécurité:
<ol><li>Sanitisation des noms de dossiers et fichiers
<li>Validation des entrées utilisateur
</ol></li></ol><h2 id="heading-utilisation-374454">Utilisation
</h2><ol><li>Ouvrez la page index.html dans un navigateur
<li>Accordez les droits quand le popup d'authentification Google apparaît. Il s'agit de permettre une navigation dans votre Google Drive.
<li>Entrez l'ID du document Google Docs (visible dans l'URL)
<li>Cliquez sur "Analyser le document"
<li>Le site généré s'ouvrira dans un nouvel onglet
</li></ol><h2 id="heading-extensions-possibles-374455">Extensions possibles
</h2><ol><li>Support de thèmes visuels multiples
<li>Amélioration du traitement des tableaux complexes
<li>Ajout d'un mode d'impression optimisé
<li>Support pour les commentaires Google Docs
<li>Fonctionnalité de recherche dans le contenu converti
</li></ol><p>
</p></div>
    </div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const objectData = {"kix.fv011bdn85o2":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXfKM_0b0WFccEchHSoWmMI0z6Ha4cWRelU3yPnl6wZq4f1cRMMfPtJVeDkYw-0bcNkFTNQKZnttgcwk6vpvp0ZI9G---eeNAvgLBTjz0MONR10pT4-pl-1m_2qJYHPIHFTxpyfP0A?key=ufJJrExlAOAtrxvIkP6JBBdq","width":719,"height":484,"rotation":0,"localFilePath":"images/kix.fv011bdn85o2.png","skipProcessing":true,"localSrc":"images/kix.fv011bdn85o2.png"},"kix.5j5m6wb3f3i0":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXfjP1FiCtgwe6ivpfoK69WFiJNqlCOPnfW6MeEd38mWracyhXvd1pv_E2tkk_CwDtJpW3stC4ZUPAu5brbbYUixw8evYt_lK_gnUgjGxiC-5xTetQIkSB2VjBflGg6du9seYT3hDQ?key=ufJJrExlAOAtrxvIkP6JBBdq","width":547,"height":574,"rotation":0,"localFilePath":"images/kix.5j5m6wb3f3i0.png","skipProcessing":true,"localSrc":"images/kix.5j5m6wb3f3i0.png"},"kix.dh109yq6g3q8":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXc9BjD22aFk5BHZiS0KQpnyeoDE9NV5_MDE3Vbv3KxsMbmCSRdhA8-Ai3lXl4xo6iaWNV8dE7do5EW3ImhUpucxNo07HYCm8vZYrhOYwwX57k0_WRPEGIk_pPStUVkXb_6vQNjw_Q?key=ufJJrExlAOAtrxvIkP6JBBdq","width":582,"height":132,"rotation":0,"localFilePath":"images/kix.dh109yq6g3q8.png","skipProcessing":true,"localSrc":"images/kix.dh109yq6g3q8.png"},"kix.wa734qqg9cbc":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXejY2Hx5aoP8boWQtut4fKqJUtqBhcmnWQt1ime9GUPypeaJ9ohb4nddpGC7u8ldlZztd5AdtcbENwd8ODNYP9ZnnSvDEHOUs_tieoVILPbLPZeC8mMutlk4XSdIw1ZgIyoivW3Cg?key=ufJJrExlAOAtrxvIkP6JBBdq","width":491,"height":286,"rotation":0,"localFilePath":"images/kix.wa734qqg9cbc.png","skipProcessing":true,"localSrc":"images/kix.wa734qqg9cbc.png"},"kix.az23sm2nwm8g":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXcrX_v3yAfhd5EQNkekMU3_lG0Ut8gv3u3p2umpCxZBDsQ29xJwEEzeQzoOexiRLbJmYFu1pAawVeHCHm4BiU7rjf6VOiEXwrl4qs7LHNyylCHywtMA3wRtKaahndkvGFrdWA7Juw?key=ufJJrExlAOAtrxvIkP6JBBdq","width":685,"height":535,"rotation":0,"localFilePath":"images/kix.az23sm2nwm8g.png","skipProcessing":true,"localSrc":"images/kix.az23sm2nwm8g.png"},"kix.60zf88wuedo":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXfPQCS99L4BwGcc2lft2fnIv7sGhlkQ2sjxvpGdukJWtDppODkktKXjY9B3Hpn6QHtVX-VVEfPgRK0FtGMqihwQbkdbMbDA8Lrryc4QOBzR8mu9KpAiIcHhNNblRMpULnptqO8abw?key=ufJJrExlAOAtrxvIkP6JBBdq","width":571,"height":253,"rotation":0,"localFilePath":"images/kix.60zf88wuedo.png","skipProcessing":true,"localSrc":"images/kix.60zf88wuedo.png"},"kix.f2p7fydaaze":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXdoGQID7WyIWG9GNyjc833Og8iSlZSYq3u-Cim22rLMQTPhRbGxWUpSJFVQkGrGAj-qH_T2ALVlcXyQHUTfcvC9Hdp4EhgqcRoj4xdiIiCKLfFo8ZE_M8lM0H0Ap-uJcNHOrtHw?key=ufJJrExlAOAtrxvIkP6JBBdq","width":575,"height":140,"rotation":0,"localFilePath":"images/kix.f2p7fydaaze.png","skipProcessing":true,"localSrc":"images/kix.f2p7fydaaze.png"},"kix.ms01npmb9850":{"type":"image","uri":"https://lh7-rt.googleusercontent.com/docsz/AD_4nXdisZ0lzRbQtgTCu-pMwm_wrmx465E5XjUkeUMMU84ZZkdlszlITgsfhyUJy3WAn8GEZo6ku2knZwFV7SCsBuknbIgZnTU6SVrbz1c990183ZhilCDTpABV2C9DaCvJ8sJkoeoJZg?key=ufJJrExlAOAtrxvIkP6JBBdq","width":563,"height":317,"rotation":0,"localFilePath":"images/kix.ms01npmb9850.png","skipProcessing":true,"localSrc":"images/kix.ms01npmb9850.png"}};
    
    // Configuration du menu responsive
    const sidebar = document.querySelector('.sidebar');
    const menuButton = document.querySelector('.menu-toggle');
    
    // Gérer l'affichage du menu sur mobile
    menuButton.addEventListener('click', function() {
      sidebar.classList.toggle('expanded');
      this.innerHTML = sidebar.classList.contains('expanded') ? '✕ Fermer' : '☰ Menu';
    });
    
    // Cacher tous les onglets sauf le premier
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(tab => {
      tab.style.display = "none";
    });
    
    // Afficher le premier onglet par défaut
    const firstTab = document.querySelector('.tab-content');
    const firstLink = document.querySelector('.nav-link');
    if (firstTab) {
      firstTab.style.display = "block";
      firstTab.classList.add('active');
    }
    if (firstLink) firstLink.classList.add('active');
    
    // Fonction pour remplacer tous les objets inline
    const replaceInlineObjects = (container) => {
      // Remplacer les objets inline
      container.querySelectorAll('span.inline-object').forEach(obj => {
        const objectId = obj.getAttribute('data-object-id');
        if (!objectId || !objectData[objectId]) {
          obj.textContent = '[Objet non disponible]';
          return;
        }
        
        const data = objectData[objectId];
        
        if (data.type === 'driveFile') {
          // Créer un élément de lien Drive
          const link = document.createElement('a');
          link.href = data.url;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.className = 'drive-file-link';
          
          // Déterminer l'icône selon le type de fichier
          let iconSvg = '';
          switch(data.fileType) {
            case 'spreadsheet':
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#0F9D58" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#0F9D58" d="M9 12H7v2h2v-2zm0-3H7v2h2V9zm0 6H7v2h2v-2zm6-6h-4v2h4V9zm0 3h-4v2h4v-2zm0 3h-4v2h4v-2z"/></svg>';
              break;
            case 'presentation':
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#F4B400" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#F4B400" d="M11 12V9h2v3h3v2h-3v3h-2v-3H8v-2h3z"/></svg>';
              break;
            case 'form':
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#673AB7" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#673AB7" d="M7 7h10v2H7zm0 4h10v2H7zm0 4h7v2H7z"/></svg>';
              break;
            case 'image':
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#34A853" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#34A853" d="M14.5 11l-3 4.5-2-3L7 16h10l-2.5-5z"/><circle fill="#34A853" cx="8.5" cy="8.5" r="1.5"/></svg>';
              break;
            case 'video':
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#EA4335" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#EA4335" d="M10 8.5v7l5-3.5-5-3.5z"/></svg>';
              break;
            default:
              iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#4285F4" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path fill="#4285F4" d="M7 7h10v2H7zm0 4h10v2H7zm0 4h7v2H7z"/></svg>';
          }
          
          link.innerHTML = `
            <div class="drive-file-icon">${iconSvg}</div>
            <div class="drive-file-info">
              <span class="drive-file-title">${data.title}</span>
              ${data.description ? `<span class="drive-file-desc">${data.description}</span>` : ''}
            </div>
          `;
          
          // Remplacer le placeholder par le lien
          obj.parentNode.replaceChild(link, obj);
          console.log('Lien Drive remplacé pour objectId:', objectId);
        }
      });
    };
    
    // Fonction pour générer automatiquement les tables des matières
    const generateTableOfContents = () => {
      const activeTab = document.querySelector('.tab-content.active');
      const tocPlaceholders = activeTab ? activeTab.querySelectorAll('.toc-placeholder[data-auto-generated="true"]') : [];
      
      if (tocPlaceholders.length === 0) return;
      
      // Trouver tous les titres dans l'onglet actif
      const headings = activeTab.querySelectorAll('h1[id]:not(.tab_title), h2[id], h3[id], h4[id], h5[id], h6[id]');
      
      if (headings.length === 0) return;
      
      // Générer le HTML de la table des matières
      const tocHtml = document.createElement('ul');
      tocHtml.className = 'toc-list';
      
      headings.forEach(heading => {
        const level = parseInt(heading.tagName.charAt(1));
        const item = document.createElement('li');
        item.className = `toc-item toc-level-${level}`;
        item.style.marginLeft = `${(level-1) * 20}px`;
        
        const link = document.createElement('a');
        link.href = `#${heading.id}`;
        link.textContent = heading.textContent;
        link.addEventListener('click', function(e) {
          e.preventDefault();
          heading.scrollIntoView({ behavior: 'smooth' });
          
          // Mettre en évidence temporairement le titre cible
          const originalBg = heading.style.backgroundColor;
          heading.style.backgroundColor = '#ffff99';
          setTimeout(() => {
            heading.style.backgroundColor = originalBg;
          }, 2000);
        });
        
        item.appendChild(link);
        tocHtml.appendChild(item);
      });
      
      // Remplir les placeholders
      tocPlaceholders.forEach(placeholder => {
        placeholder.innerHTML = '';
        placeholder.appendChild(tocHtml.cloneNode(true));
      });
    };
    
    // Remplacer les objets dans l'onglet actif initial
    replaceInlineObjects(firstTab);
    
    // Générer les tables des matières
    generateTableOfContents();
    
    // Ajouter des écouteurs d'événements à tous les liens de navigation
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Supprimer la classe active de tous les liens et contenus
        navLinks.forEach(l => l.classList.remove('active'));
        tabContents.forEach(tab => {
          tab.classList.remove('active');
          tab.style.display = "none";
        });
        
        // Ajouter la classe active au lien et contenu cliqués
        this.classList.add('active');
        const targetId = this.getAttribute('href').substring(1);
        const targetTab = document.getElementById(targetId);
        if (targetTab) {
          targetTab.classList.add('active');
          targetTab.style.display = "block";
          
          // Remplacer les objets dans l'onglet nouvellement affiché
          replaceInlineObjects(targetTab);
          
          // Générer les tables des matières pour le nouvel onglet
          setTimeout(() => {
            generateTableOfContents();
          }, 100);
        }
        
        // Fermer le menu sur mobile après sélection d'un onglet
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('expanded');
          menuButton.innerHTML = '☰ Menu';
        }
      });
    });
  });
</script>
</body>
</html>
  